<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta name="description" content="童话说，一个关于Web前端的个人技术博客，不定期发布Web前端及其相关技术的博文">
  <meta name="keywords" content="tonghuashuo,github,前端,html,css,javascript,android,童话,童话说,华心童,webpack,dev,server,invalid,host,header,disable,check">
  <title>解决 Webpack Dev Server "Invalid Host Header" 问题</title>
  <link rel="shortcut icon" href="../img/favicon.ico" />
  <link rel="stylesheet" href="../css/index.css" />
  <link rel="stylesheet" href="../css/blog.css" />
  
  <!-- code highlight -->
  <link rel="stylesheet" href="../lib/hljs/monokai-sublime.css">

</head>
<body>

  <div id="mf_content">
    <article id="webpack-dev-server-invalid-host-header">
      <h1>解决 Webpack "Invalid Host Header"</h1>
      <div class="time"><time datetime="2017-05-04">May 4th 2017<time></div>
      <div class="titleBanner"></div>
      
      <p>一直以来都在用 Webpack 打包代码，配合 webpack-devserver 作 Hot Module Replacement 感觉棒棒哒，可以专心于程序逻辑，不用被无关紧要的琐事打扰。直到刚才……</p>

      <h2>突如其来的问题</h2>
      <p>正和同事讨论一个技术问题，写了个 Demo 打算发链接过去一起看看，结果同事说打不开，报“Invalid Host Header”，可我本机运行正常。试了下别的设备，一样打不开，确定问题真的存在。既然在本机能跑通，说明问题应该不在代码，而在于网络，<span class="code">ifconfig</span> 检查了下 IP 地址，没错，仔细检查了一遍链接地址，也没有拼写错误，那看来是哪里配置有问题。</p>
      <p>有问题，找度娘，结果度娘给了一堆有的没的，StackOverflow 上似乎也没有类似的情况，于是打算去 Github 上翻翻 Issue，也没有符合的。</p>

      <h2>灵光一现</h2>
      <p>突然想到前两天刚更新过一批 npm 的包，其中就有 webpack 和 webpack-dev-server，不过主版本号没有变，理论上不大可能会有 Breaking Change，抱着试一试的心态，去看了下 Releases，结果意外发现了惊喜。</p>
      <p>webpack-dev-server 在大约两周前更新了 2.4.3 和 1.16.4 两个版，除了常规的 BugFixes 和 Features，还特别注明了一项 Security Fix，并指出这很可能是一个 Breaking Change，但因为并没有涉及到架构、主要功能等影响重大的地方，因此犯不上增加 Major Version，只是作为安全性补丁，更新了 Patch Version。</p>
      <p>这轮更新主要是新增了对 host header 的正确性检测（就是我当前遇到的问题），以屏蔽未经授权的访问。开发者需要在执行 webpack-dev-server 命令时手动添加 --public 选项，取值为授权的 host，否则响应中就会提示这个问题，也就是我们看到的“Invalid Host Header”。</p>

      <h2>解决方案</h2>
      <p>官方提供了两个解决方案：</p>
      <ul>
        <li>执行 webpack-dev-server 命令时手动添加 --public 选项，取值为授权的 host，这是官方建议的做法，目的是为了安全。</li>
        <li>设置 webpack-dev-server 的配置项 disableHostCheck 为 true 以禁用这一检测，如果开发者使用了代理，或在开发环境中不 care 这些安全问题，该设置可以直接斩草除根。</li>
      </ul>

      <h2>例外</h2>
      <p>当然，或许你并没有遇到这样的问题（等等，如果你没遇到这个问题，你又是出于什么原因把这篇文章看到了这里？），因为官方贴心的设置了一些例外场景，这些场景下不受该补丁的影响：</p>
      <ul>
        <li>host 为 localhost 或 127.0.0.1 时不会受阻</li>
        <li>只有使用 webpack-dev-server 或 webpack-dev-middleware 时会进行该项检测，webpack 和 打包后的代码不受此影响。</li>
      </ul>

      <h2>写在最后</h2>
      <p>创业公司对新技术的使用还是比较大胆的，这点是好事也是坏事。好处是总能接触到较为前沿的技术，对个人能力的提升非常有利；坏处就是坑多。当下技术更新飞快，尤其前端圈子，版本更新频率跟手机 App 一样，隔三差五就有新版本出来了，若只有一个倒也罢了，可现在哪个项目还不依赖个一堆 npm 包，横竖不能每次都去 Change Log 里找看有没有 Breaking Change 吧，更新引入新坑也是在所难免，这时候就体现出文档的重要性了。</p>
      
    </article>

  </div>

  <script src="../js/index.js"></script>
  
  <!-- code highlight -->
  <script src="../lib/hljs/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  
  <!-- line number -->
  <script src="../lib/jquery-3.0.0-beta1.min.js"></script>
  <script src="../js/line-number.js"></script>
</body>
</html>