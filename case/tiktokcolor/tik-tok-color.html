<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>TikTok Color</title>

	<style>
	body{
		padding: 0px;
		-webkit-transition: all 0.8s;
		-moz-transition: all 0.8s;
		transition: all 0.8s;
	}
	
	h1 {
		font-size: 8em;
		color: #FFF;
		font-family: Helvetica, Tahoma, sans-serif;
		margin-top: 1em;
		margin-bottom: 0;
		text-align: center;
		-webkit-transition: all 0.8s;
		-moz-transition: all 0.8s;
		transition: all 0.8s;
	}

	h4 {
		font-size: 2em;
		color: #FFF;
		font-family: Helvetica, Tahoma, sans-serif;
		margin-top: 0;
		text-align: center;
		-webkit-transition: all 0.8s;
		-moz-transition: all 0.8s;
		transition: all 0.8s;
	}

	#mode_switch{
		height: 60px;
		width: 366px;
		min-width: 366px;
		/*padding: 0;*/
		-webkit-transition: width 0.8s;
		-moz-transition: width 0.8s;
		transition: width 0.8s;
	}

	#btn_rgb, #btn_hsl, #btn_cmyk {
		font-family: Helvetica, Tahoma, sans-serif;
		font-weight: 700;
		float: left;
		width: 100px;
		height: 40px;
		border: 1px solid #FFF;
		border-radius: 4px;
		color: #FFF;
		padding: 0;
		margin: 10px;
		text-align: center;
		line-height: 40px;
		-webkit-transition: all 0.8s;
		-moz-transition: all 0.8s;
		transition: all 0.8s;
	}

	#btn_rgb:hover, #btn_hsl:hover, #btn_cmyk:hover {
		cursor: pointer;
	}

	@media all and (max-width: 1024px) {
		h1 {
			font-size: 5em;
			margin-top: 2em;
		}
		h4 { 
			font-size: 1.4em;	
		}
		#mode_switch {
			width: 306px;
			min-width: 306px;
		}
		#btn_rgb, #btn_hsl, #btn_cmyk {
			width: 80px;
			height: 30px;
			line-height: 30px;
			font-size: 0.8em;
		}
	}

	@media all and (max-width: 480px) {
		h1 {
			font-size: 4em;
			margin-top: 3em;
		}
		h4 {
			font-size: 1.2em;
		}
		#mode_switch {
			width: 276px;
			min-width: 276px;
		}
		#btn_rgb, #btn_hsl, #btn_cmyk {
			width: 70px;
			height: 25px;
			line-height: 25px;
			font-size: 0.7em;
		}
	}

	@media all and (max-width: 320px) {
		h1 {
			font-size: 3em;
			margin-top: 4em;
		}
		h4 {
			font-size: 1.0em;
		}
		#mode_switch {
			width: 246px;
			min-width: 246px;
		}
		#btn_rgb, #btn_hsl, #btn_cmyk {
			width: 60px;
			height: 20px;
			line-height: 20px;
			font-size: 0.6em;
		}
	}
	</style>
</head>
<body>
	<h1 id="time"></h1>
	<h4 id="color"></h4>

	<div id="mode_switch">
		<div id="btn_rgb" class="chosen">RGB</div>
		<div id="btn_hsl">HSL</div>
		<div id="btn_cmyk">CMYK</div>
	</div>

	<script>
	/* rgb, hsl, cmyk */
	var mode = "rgb";
	// var mode = "cmyk";

	window.onload = function(){
		var time = document.getElementById("time");
		var color = document.getElementById("color");
		var mode_switch = document.getElementById("mode_switch");
		var btn_rgb  = document.getElementById("btn_rgb");
		var btn_hsl  = document.getElementById("btn_hsl");
		var btn_cmyk = document.getElementById("btn_cmyk");
		
		// button behaviors
		btn_rgb.onclick = function(){
			btn_rgb.className  = "chosen";
			btn_hsl.className  = "";
			btn_cmyk.className = "";
			mode = "rgb";
			tiktok();
		};
		btn_hsl.onclick = function(){
			btn_rgb.className  = "";
			btn_hsl.className  = "chosen";
			btn_cmyk.className = "";
			mode = "hsl";
			tiktok();
		};
		btn_cmyk.onclick = function(){
			btn_rgb.className  = "";
			btn_hsl.className  = "";
			btn_cmyk.className = "chosen";
			mode = "cmyk";
			tiktok();
		};
		
		position();
		window.onresize = position;

		tiktok();
		setInterval(tiktok, 1000);
	}

	// layout
	function position(){
		var modeswitch_width = getCurrentStyle(mode_switch)['width'];
		var modeswitch_width_val = Number(modeswitch_width.substr(0, modeswitch_width.length-2));
		mode_switch.style.marginLeft = ( window.innerWidth - modeswitch_width_val ) / 2 + "px";
	}

	// get computed style
	function getCurrentStyle(node) {
	    var style = null;
	    
	    if(window.getComputedStyle) {
	        style = window.getComputedStyle(node, null);	// Not IE
	    }else{
	        style = node.currentStyle;	// IE
	    }
	    
	    return style;
	}

	function tiktok() {
		var date = new Date();
		var day  = date.getDate();
		var hour = date.getHours();
		var min  = date.getMinutes();
		var sec  = date.getSeconds();

		if(day<10)	{day  = "0" + day;}
		if(hour<10) {hour = "0" + hour;}
		if(min<10)  {min  = "0" + min;}
		if(sec<10)  {sec  = "0" + sec;}

		/* time */
		var time_val = hour + ":" + min + ":" + sec;

		/* set color by mode*/
		var color_val = null;		// rgb(r, g, b)
		var color_str = null;	// RGB/HSL/CMYK
		var hex = null;		// #rrggbb

		if (mode == "rgb") {
			/* RGB  R:0-255  G:0-255  B:0-255 */
			var r = hour;
			var g = min;
			var b = sec;
			var rgb = "rgb(" + r + "," + g + "," + b + ")";
			color_val = rgb;
			color_str = "R:" + r + "&nbsp&nbspG:" + g + "&nbsp&nbspB:" + b;
		} else if (mode == "hsl") {
			/* HSL  H:0-360  S:0-100%  L:0-100% */
			var h = hour;
			var s = min;
			var l = sec;
			var hsl = "hsl(" + h + "," + s + "%," + l + "%)";
			var rgb4hsl = hsl2rgb(hsl);
			color_val = rgb4hsl;
			color_str = "H:" + h + "&nbsp&nbspS:" + s + "&nbsp&nbspL:" + l;
		} else {
			/* CMYK  C:0-100%  M:0-100%  Y:0-100%  K:0-100% */
			var c = hour;
			var m = min;
			var y = sec;
			var k = day;

			var r = Math.round( (1 - c/100 * ( 1 - k/100 ) - k/100 ) * 255);
			var g = Math.round( (1 - m/100 * ( 1 - k/100 ) - k/100 ) * 255);
			var b = Math.round( (1 - y/100 * ( 1 - k/100 ) - k/100 ) * 255);
			
			var rgb4cmyk = "rgb(" + r + "," + g + "," + b + ")";
			color_val = rgb4cmyk;
			color_str = "C:" + c + "&nbsp&nbspM:" + m + "&nbsp&nbspY:" + y + "&nbsp&nbspK:" + k;
		}

		hex = rgb2hex(color_val);
		console.log("[hex]" + hex+"    [color]" + color_val+"    [mode]" + mode);


		// apply data
		time.innerHTML = time_val;
		color.innerHTML = color_str + "&nbsp&nbsp(" + hex + ")";
		document.body.style.backgroundColor = color_val;

		// button color fix
		var theme_array = color_val.substring(4, color_val.length-1).trim().split(',');
		var theme_r = Number(theme_array[0]);
		var theme_g = Number(theme_array[1]);
		var theme_b = Number(theme_array[2]);

		if ( Math.max(theme_r,theme_g,theme_b) > 127 ) {
			color.style.color = "#000";
			time.style.color = "#000";
		} else {
			color.style.color = "#FFF";
			time.style.color = "#FFF";
		}

		var btns = mode_switch.childNodes;
		for (var i=1; i<btns.length; i+=2) {
			if(btns[i].className == "chosen") {
				btns[i].style.color = color_val;
				if ( Math.max(theme_r,theme_g,theme_b) > 127 ) {
					btns[i].style.backgroundColor = "#000";
					btns[i].style.borderColor = "#000";
				} else {
					btns[i].style.backgroundColor = "#FFF";
					btns[i].style.borderColor = "#FFF";
				}
			} else {
				btns[i].style.backgroundColor = color_val;
				if ( Math.max(theme_r,theme_g,theme_b) > 127 ) {
					btns[i].style.color = "#000";
					btns[i].style.borderColor = "#000";
				} else {
					btns[i].style.color = "#FFF";
					btns[i].style.borderColor = "#FFF";
				}
			}
		}
	}

	// from rgb(r, g, b) to #rrggbb
	function rgb2hex(color) {
		var rgb_array = color.substring(4,color.length-1).trim().split(',');
		var rd = Number(rgb_array[0]);
		var gd = Number(rgb_array[1]);
		var bd = Number(rgb_array[2]);
		var rh = dec2hex(rd);
		var gh = dec2hex(gd);
		var bh = dec2hex(bd);
		var hex = "#" + rh +gh + bh;
		// console.log("rgb2hex:" + hex);
		return hex;
	}

	// from decimal to heximal
	function dec2hex(dec) {
		var d = Number(dec);
		if(d < 16) {
			return "0" + d.toString(16);
		}
		return d.toString(16);
	}

	// convert from HSL to RGB
	function hsl2rgb(hsl) {
		var hsl_array = hsl.substring(4,hsl.length-1).trim().split(',');
		var h = Number(hsl_array[0]);
		var s = Number(hsl_array[1].substring(0, hsl_array[1].length-1))/100;
		var l = Number(hsl_array[2].substring(0, hsl_array[2].length-1))/100;
		// console.log("hsl_array:"+h+"|"+s+"|"+l);
		var r, g, b;
		if(s==0) {
			r=l; g=l; b=l;	// pure grey
		} else {
			var tmp2 = (l<0.5) ? (l*(1+s)) : ((l*100+s*100)-l*s*100)/100;
			var tmp1 = (2*l*100-tmp2*100)/100;
			var h2 = h/360;

			function hue2rgb(tmp1, tmp2, tmp3){
				// console.log("tmp1: " + tmp1 + ", tmp2: " + tmp2 + ", tmp3: " + tmp3);
	            if(tmp3 < 0) tmp3 += 1;
	            if(tmp3 > 1) tmp3 -= 1;
	            var result = 0;
	            if(tmp3 < 1/6) {
	            	result =  tmp1 + (tmp2 - tmp1) * 6 * tmp3;
	            } else if(tmp3 < 1/2) {
	            	result =  tmp2;
	            } else if(tmp3 < 2/3) {
	            	result =  tmp1 + (tmp2 - tmp1) * (2/3 - tmp3) * 6;
	            } else {
	            	result = tmp1;
	            }
	            return Math.round(result*255);
	        }

	        r = hue2rgb(tmp1, tmp2, h2 + 1/3);
	        g = hue2rgb(tmp1, tmp2, h2);
	        b = hue2rgb(tmp1, tmp2, h2 - 1/3);
		}
		var rgb = "rgb(" + r + "," + g + "," + b + ")";
		// console.log("hsl2rgb: " + rgb);
		return rgb;
	}

	</script>
</body>
</html>